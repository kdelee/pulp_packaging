- job-template:
    name: 'pulp-{pulp_version}-{pulp_build}-restore-{os}'
    node: '{os}-np'
    properties:
        - qe-intern
        - copyartifact:
            projects: pulp-restore
    scm:
        - elijah-pulp-packaging-github
    wrappers:
        - config-file-provider:
            files:
                - file-id: rhn_credentials
                  variable: RHN_CREDENTIALS
        - inject:
            properties-content: |
                OS={os}
                PULP_BUILD={pulp_build}
                PULP_VERSION={pulp_version}
    triggers:
        - reverse:
            jobs: 'pulp-2.11-stable-backup-rhel6'
            result: 'success'
    builders:
        - copyartifact:
            project: 'pulp-2.11-stable-backup-rhel6'
            which-build: last-successful
            flatten: true
        - shell:
            !include-raw-escape:
                - 'ssh-setup.sh'
        - shell:
            !include-raw-escape:
                - 'pulp-restore.sh'
        - shell: |
            if [[ "${{OS}}" =~ "rhel" ]]; then
                sudo subscription-manager unregister
                sudo subscription-manager clean
            fi
        - capture-logs
    publishers:
        - junit:
            results: "*.xml"
        - email-notify-owners
        - mark-node-offline
